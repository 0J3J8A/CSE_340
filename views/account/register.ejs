<%- include('../partials/header') %>

<main>
    <h1><%= title %></h1>
    
    <!-- Display flash messages if any -->
    <% if (messages && messages.error) { %>
        <div class="flash-message error">
            <p><%= messages.error %></p>
        </div>
    <% } %>
    <% if (messages && messages.success) { %>
        <div class="flash-message success">
            <p><%= messages.success %></p>
        </div>
    <% } %>
    
    <!-- Display validation errors -->
    <% if (errors) { %>
        <ul class="notice">
            <% errors.array().forEach(error => { %>
                <li><%= error.msg %></li>
            <% }) %>
        </ul>
    <% } %>
    
    <!-- Registration Form -->
    <div class="form-container">
        <form action="/account/register" method="post" class="form" id="registrationForm">
            <!-- First Name -->
            <div class="form-group">
                <label for="account_firstname">First Name *</label>
                <input 
                    type="text" 
                    id="account_firstname" 
                    name="account_firstname" 
                    placeholder="Enter your first name" 
                    required
                    pattern="[A-Za-z\s]{2,}"
                    title="First name must be at least 2 characters long and contain only letters"
                    class="form-input"
                    value="<%= locals.account_firstname %>"
                >
                <div class="input-hint">Must be at least 2 characters, letters only</div>
            </div>
            
            <!-- Last Name -->
            <div class="form-group">
                <label for="account_lastname">Last Name *</label>
                <input 
                    type="text" 
                    id="account_lastname" 
                    name="account_lastname" 
                    placeholder="Enter your last name" 
                    required
                    pattern="[A-Za-z\s]{2,}"
                    title="Last name must be at least 2 characters long and contain only letters"
                    class="form-input"
                    value="<%= locals.account_lastname %>"
                >
                <div class="input-hint">Must be at least 2 characters, letters only</div>
            </div>
            
            <!-- Email -->
            <div class="form-group">
                <label for="account_email">Email Address *</label>
                <input 
                    type="email" 
                    id="account_email" 
                    name="account_email" 
                    placeholder="Enter your email (example@domain.com)" 
                    required
                    title="Please enter a valid email address"
                    class="form-input"
                    value="<%= locals.account_email %>"
                >
                <div class="input-hint">Must be a valid email format</div>
            </div>
            
            <!-- Password with toggle -->
            <div class="form-group">
                <label for="account_password">Password *</label>
                <div class="password-container">
                    <input 
                        type="password" 
                        id="account_password" 
                        name="account_password" 
                        placeholder="Enter your password" 
                        required
                        pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{12,}$"
                        title="Password must be at least 12 characters and contain at least 1 number, 1 lowercase letter, 1 capital letter and 1 special character"
                        class="form-input"
                    >
                    <button type="button" id="togglePassword" class="password-toggle" aria-label="Show password">
                        üëÅÔ∏è‚Äçüó®Ô∏è
                    </button>
                </div>
                <div class="password-requirements">
                    <p class="requirements-title">Password Requirements:</p>
                    <ul class="requirements-list">
                        <li>Minimum 12 characters</li>
                        <li>At least 1 lowercase letter (a-z)</li>
                        <li>At least 1 capital letter (A-Z)</li>
                        <li>At least 1 number (0-9)</li>
                        <li>At least 1 special character (!@#$%^&* etc.)</li>
                        <li>No spaces allowed</li>
                    </ul>
                </div>
            </div>
            
            <!-- Submit Button -->
            <div class="form-group">
                <button type="submit" class="btn btn-primary" id="submitBtn">Register</button>
            </div>
            
            <div class="form-note">
                <p>* All fields are required and must meet the validation criteria</p>
            </div>
        </form>
        
        <!-- Login link -->
        <div class="registration-link">
            <p>Already have an account? <a href="/account/login">Login here</a></p>
        </div>
    </div>
</main>

<!-- Password Toggle JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const togglePassword = document.querySelector('#togglePassword');
    const passwordInput = document.querySelector('#account_password');
    
    if (togglePassword && passwordInput) {
        togglePassword.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.textContent = type === 'password' ? 'üëÅÔ∏è‚Äçüó®Ô∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è';
            this.setAttribute('aria-label', type === 'password' ? 'Show password' : 'Hide password');
        });
    }
    
    // Real-time validation feedback
    const form = document.getElementById('registrationForm');
    const inputs = form.querySelectorAll('.form-input');
    
    inputs.forEach(input => {
        // Validate on blur
        input.addEventListener('blur', function() {
            validateInput(this);
        });
        
        // Validate on input (for real-time feedback)
        input.addEventListener('input', function() {
            validateInput(this);
        });
    });
    
    // Form submission validation
    form.addEventListener('submit', function(event) {
        let isValid = true;
        
        inputs.forEach(input => {
            if (!validateInput(input)) {
                isValid = false;
            }
        });
        
        if (!isValid) {
            event.preventDefault();
            // Scroll to first invalid input
            const firstInvalid = form.querySelector('.form-input:invalid');
            if (firstInvalid) {
                firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstInvalid.focus();
            }
        }
    });
    
    function validateInput(input) {
        const hint = input.parentElement.querySelector('.input-hint');
        
        if (input.validity.valid) {
            input.classList.remove('invalid');
            input.classList.add('valid');
            if (hint) hint.style.color = 'var(--success-color)';
            return true;
        } else {
            input.classList.remove('valid');
            input.classList.add('invalid');
            if (hint) hint.style.color = 'var(--warning-color)';
            
            // Show specific error messages
            if (input.validity.valueMissing) {
                input.setCustomValidity('This field is required');
            } else if (input.validity.typeMismatch && input.type === 'email') {
                input.setCustomValidity('Please enter a valid email address');
            } else if (input.validity.patternMismatch) {
                if (input.id === 'account_password') {
                    input.setCustomValidity('Password does not meet requirements');
                } else {
                    input.setCustomValidity('Please check the format');
                }
            } else {
                input.setCustomValidity('');
            }
            
            return false;
        }
    }
});
</script>

<%- include('../partials/footer') %>